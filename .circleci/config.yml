version: 2.1
# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  # Below is the definition of your job to build and test your app, you can rename and customize it as you want.
  test:
    docker:
      - image: cimg/openjdk:8.0
    steps:
      - checkout
      - run: ./mvnw test

  build:
    docker:
      - image: cimg/openjdk:8.0
    steps:
      - checkout
      - run: ./mvnw -Dmaven.test.skip=true package

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  build-then-test:
    jobs:
      - build:
        filters:
          branches:
            only:
              - dev
      - test:
          requires:
            - build